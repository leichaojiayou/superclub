const app = getApp();
const mineApi = app.api("mineApi");
var tradeId = 0;

Page({
  data: {
    info: {},
    page1: {
      payment_text: '活动付款',
      payment_name_text: '微信支付',
      payment_price: '80.00',
      activity_text: '8月初新疆七天自驾游招募旅伴',
      activity_date: '2015-12-25 17:34',
      receipt_text: '收款',
      receipt_price: '80.00',
      receipt_user: '黄新飞 - 12239390000',
      activity_date: '2015-12-25 17:34',
      withdraw_text: '提现',
      withdraw_price: '80.00',
      withdraw_bank: '提现到招商银行（尾号2345）',
      withdraw_date: '2015-12-25 17:34',
    },
    page2: {
      user_text: "黄鑫峰 - 18923742828",
      activity_text: '8月初新疆七天自驾游招募旅伴',
      payment_text: '实收',
      payment_price: '80.00',
      payment_user_text: "用户付款",
      order_text: "订单编号",
      order_number: '35436564',
      payment_way_text: '付款方式',
      payment: '支付宝',
      payment_Rate_text: '支付宝费率',
      payment_Rate: '1.30',
      subsidy_text: '超级俱乐部补贴',
      subsidy: "1.30",
      pay_time_text: "付款时间",
      pay_time: "2015-07-12 20:34:23",
      transaction_text: "交易单号",
      transaction: '375489357985722657657',
      accounts_receivable_text: '收款账户',
      accounts_receivable: '黄锡成-298732',
    },
    page3: {
      activity_text: '8月初新疆七天自驾游招募旅伴',
      activity_date: '活动时间 : 07月12日 20:34 - 07月12日24:00',
      total_text: '总金额:160.00',
      activity_payment_list: [{
        payment_text: '活动付款',
        payment_price: '80.00',
        order_text: "订单编号",
        order_number: '35436564',
        user_information_text: '报名信息',
        user_text: "黄习恒-18937287784",
        payment_way_text: '付款方式',
        payment: '微信支付',
        pay_time_text: "付款时间",
        pay_time: "2015-07-12 20:34:23",
        transaction_text: "交易单号",
        transaction: '375489357985722657657',
        accounts_receivable_text: '收款账户',
        accounts_receivable: '黄锡成-298732',
      }, {
        payment_text: '活动付款',
        payment_price: '80.00',
        order_text: "订单编号",
        order_number: '35436564',
        user_information_text: '报名信息',
        user_text: "黄习恒-18937287784",
        payment_way_text: '付款方式',
        payment: '微信支付',
        pay_time_text: "付款时间",
        pay_time: "2015-07-12 20:34:23",
        transaction_text: "交易单号",
        transaction: '375489357985722657657',
        accounts_receivable_text: '收款账户',
        accounts_receivable: '黄锡成-298732',
      }],

    },
    statu: 2,
    //statu: 1 交易记录
    //statu: 2 交易记录-活动收款
    //statu: 3 交易记录-多人
  },
  onLoad: function (options) {
    if (options.tradeId) {
      tradeId = options.tradeId;
    }
    this.getTradeDetail();
  },
  getTradeDetail: function () {
    var that = this;
    mineApi.tradeRecordDetail({
      data: {
        trade_id: tradeId
      },
    },
      function (res) {
        var info = res.data.tradeRecord;

        if(info.tradeType==1){
          info.tradeDetailInfo.activity.beginTimeStr = app.util.formatTime5(info.tradeDetailInfo.activity.beginTime);
          info.tradeDetailInfo.activity.endTimeStr = app.util.formatTime5(info.tradeDetailInfo.activity.endTime);
          var orderForms = info.tradeDetailInfo.orderForms;
          for(var i in orderForms){
            orderForms[i].payTimeStr = app.util.formatTime6(orderForms[i].payTime);
          }
        }else if(info.tradeType==2){
          info.tradeDetailInfo.activity.beginTimeStr = app.util.formatTime5(info.tradeDetailInfo.activity.beginTime);
          info.tradeDetailInfo.activity.endTimeStr = app.util.formatTime5(info.tradeDetailInfo.activity.endTime);
          info.tradeDetailInfo.orderForm.refundTimeStr = app.util.formatTime6(info.tradeDetailInfo.orderForm.refundTime);
        }else if(info.tradeType==3){
          info.tradeDetailInfo.orderForm.payTimeStr = app.util.formatTime6(info.tradeDetailInfo.orderForm.payTime);
        }else if(info.tradeType==4){
          info.tradeDetailInfo.orderForm.refundTimeStr = app.util.formatTime6(info.tradeDetailInfo.orderForm.refundTime);
        }else if(info.tradeType==5){
          info.tradeDetailInfo.withdrawInfo.createTimeStr = app.util.formatTime6(info.tradeDetailInfo.withdrawInfo.createTime);
          var apply = info.tradeDetailInfo.withdrawInfo.apply;
          for(var i in apply){
            apply[i].timeStr = app.util.formatTime6(apply[i].time);
          }
        }else if(info.tradeType==7){
          info.tradeDetailInfo.orderInfo.SettlementTimeStr = app.util.formatTime6(info.tradeDetailInfo.orderInfo.SettlementTime);
        }else if(info.tradeType==8){
          info.tradeDetailInfo.orderInfo.SettlementTimeStr = app.util.formatTime6(info.tradeDetailInfo.orderInfo.SettlementTime);
        }

        that.setData({
          info: info
        })
      },
      function (res) {
        console.log("fail");
      },
      function (res) {
        app.util.getErrorMsg(res);
      }
    )
  },
  
})