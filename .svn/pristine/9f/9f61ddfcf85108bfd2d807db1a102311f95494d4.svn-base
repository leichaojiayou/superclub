// pages/mine/me/me.js
const app = getApp();

Page({
  data: {
    dataList: [],
    start:'0',
    more:0,
    applyActCount: 0,
    msg: {
      userName: app.session.getUserInfo().nick,
      userAvater: app.session.getUserInfo().avatar,
      userNum: app.session.getUserInfo().num,
      bindPhone: app.session.getUserInfo().mobile,
    }
  },
  onLoad: function(){
    var that = this;
    app.mineApi.userApplyList({//请求报名记录
      data: {
        failToast: true,
        successToast: true,
        user_id: 10237,
        start: that.data.start,
        count: 30
      },
    },
    function(res){
        console.log("success");
        var dataArr=res.data.activities;
        var dataList=that.data.dataList;
        //合并数组，用于上拉加载更多
        var renderArr=that.data.start=='0' ? dataArr : dataList.concat(dataArr);
        that.setData({
          dataList: renderArr,
          start: res.data.start,
          more: res.data.more,
          applyActCount: res.data.applyActCount,
        })
    },
    function(res){
        console.log("fail");
    },
    function(res){
        console.log("complete");
          console.log(res);
          util.getErrorMsg(res);
    }
  )},
  // 页面上拉触底事件的处理函数，用于上拉加载更多
  loadMore:function(){
      if(this.data.more == 1){
        this.onLoad();
      }
      return false;
  },
  refresh: function(){
      this.setData({ 
          start:'0',
          hasRefresh:true
      })
      this.onLoad();
  },
  navBackstage: function (e) {
    wx.navigateTo({
      url: '../mine/backstage/backstage',
      success: function (res) {
        // success
      },
      fail: function () {
        // fail
      },
      complete: function () {
        // complete
      }
    })
  },
  
  changeApply: function (e) {
    wx.navigateTo({
      url: '../../activity/apply_paged/apply_paged'
    })
  },
  cancelApply: function (e) {
    wx.navigateTo({
      url: '../mine/helpenlist/helpenlist'
    })
  },
  toPay: function (e) {
    wx.navigateTo({
      url: '../../activity/payment/payment'
    })
  },
  nato_myaccount: function (e) {
    wx.navigateTo({
      url: '../myaccount/myaccount'
    })
  },
  toMyWallet: function (e) {
    wx.navigateTo({
      url: '../myaccount/myaccount'
    })
  }
})