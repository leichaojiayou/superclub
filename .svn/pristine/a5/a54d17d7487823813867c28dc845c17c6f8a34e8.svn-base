//活动详情页面
//var actApi = require('../../../api/activity/actApi');
const utils = require('../../../utils/util')
const app = getApp();
const actApi = app.actApi;


//测试数据
var activityId = 591623;
var clubId = 100315;
Page({
    data: {
        activityEntity: {},//活动详情实体
        cover: '',//活动封面
        actTitle: '',//活动标题
        publishMan: '',//发布者昵称
        createTime: '',//发布时间
        readNum: '',//阅读量
        shareNum: '',//分享量
        actAddress: '',//活动地点描述
        hideActAddress: false,//没有设置地点时隐藏
        actTime: '',//活动时间（2014.1.1-2014.2.2）
        actCost: '',//活动费用（¥150～¥300）
        hideActCost: false,//免费活动隐藏票价选项
        host: '',//举办方（广州市花都区户外运动俱乐部）
        hideHost: '',//是否显示举办方
        contents: [],
        status: 0,
    },
    changecolor: function (e) {//切换tab操作
        let id = e.target.id;
        this.setData({
            status: id
        })
        console.log(this.data.status);
    },
    changebtn: function (e) {
        wx.showActionSheet({
            itemList: ['帮人报名', '取消报名', '修改资料'],
            success: function (res) {
                console.log(res.tapIndex)
                if (res.tapIndex == 0) {
                    wx.navigateTo({
                        url: '../apply_page/apply_page'
                    })
                }
            }
        })
    },
    onLoad: function () {
        wx.setNavigationBarTitle({
            title: '活动详情'
        });
        let that = this;
        actApi.getActDetail({
                data: {
                    activity_id: activityId,
                    club_id: clubId
                },
            },
            function (res) {//成功回调
                let data = res.data.activityEntity;
                that.setData({
                    activityEntity: data,
                    cover: data.cover,
                    actTitle: data.title,
                    publishMan: data.actUserNick,
                    createTime: utils.formatTime(new Date(data.createTime)) + '发布',
                    readNum: '阅读' + data.readNum,
                    shareNum: '分享' + data.shareNum,
                    actAddress: data.actAddress,
                    hideActAddress: data.lngInt != 0 && data.latInt != 0,//经纬度都为0则是没有设置地址
                    actTime: utils.formatTime(new Date(data.beginTime)) + '-' + utils.formatTime(new Date(data.endTime)),
                    actCost: '¥' + data.cost,
                    hideActCost: data.howToPay != 1,//免费活动不显示 费用内容
                    publishClub: data.clubName,
                    hideHost: data.clubId != 0,
                    contents: data.contents,
                })
                console.info(JSON.stringify(res.data))
            },
            function (res) {//失败回调
                let errorMsg = utils.getErrorMsg(res);
                wx.showModal({title: '活动详情加载失败', content: errorMsg.title + '；' + errorMsg.content})
            })
    }
})