// pages/remove_member_page/remove_member_page.js
const App = getApp();
const clubApi = App.api('clubApi');
const wxService = App.wxService;
const config = require('../../../../utils/constant')
Page({
  data: {
    search_text: '搜索',
    remove_text: '每日移除上限',
    remove: '20人',
    icon_img: config.CDN_URL + '/xiaochengxu/image/right-errow.png',
    search: config.CDN_URL + '/xiaochengxu/image/search.png',
    button_text: '取消',
    button_text1: '确定',
    ids: ''
  },
  onLoad: function (e) {
    this.setData({
      clubID: e.clubID
    })
    let param = { data: {} }, that = this;
    param.data.club_id = e.clubID;
    param.data.flag = 1;
    clubApi.memeberList(param, res => {
      console.log(res)
      if (res.data.status == 1) {
        const members = res.data.members
        that.setData({
          members: members
        });
      }
    });
  },

  select: function (e) {
    let members = this.data.members, userId = e.currentTarget.dataset.userid, ids = this.data.ids;
    for (let i = 0; i < members.length; i++) {
      let user = members[i].users;
      for (let j = 0; j < user.length; j++) {
        if (userId == user[j].userID) {
          if (user[j].flag) {
            user[j].flag = false;
            let newIds = ids.split(user[j].userID + ',');
            ids = newIds[0] + newIds[1]
          } else {
            user[j].flag = true;
            ids += user[j].userID + ',';
          }
        }
      }
    }
    this.setData({
      members: members,
      ids: ids
    });

  },

  ensure: function (e) {
    let data = this.data, param = { data: {} }
    param.data.club_id = data.clubID;
    param.data.user_ids = data.ids.slice(0, -1);
    let toastParam = {
      content: '确定移除'+param.data.user_ids.split(',').length+'位成员？',
    }
    wxService.showModal(toastParam, res => {
      if (res.confirm) {
        clubApi.memberRemove(param, res => { }, res => { }, res => {
          if (res.data.status == 1) {
            wxService.redirectTo('./removeMember')
          }
        });
      }
    });
  },
  cancel: e => {
    App.wxService.navigateBack();
  }
})