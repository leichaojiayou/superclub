// pages/baomingbiaoge/baomingbiaoge.js
Page({
  data: {
    title: [],
    contents:[],
    activityID:0,
    howToPay:0,
  },
  onLoad: function (options) {
    var activityID = options.activityID
    var howToPay = options.howToPay
    var title = [
      '昵称',
      '帮报名者',
      '会员号',
      '会员昵称',
      '电话',
      '性别',
      '报名时间',
    ]
    if(howToPay > 1){
        title = [
        '昵称',
        '帮报名者',
        '会员号',
        '会员昵称',
        '电话',
        '付款金额',
        '性别',
        '报名时间',
        '支付方式',
        '支付状态',
        ]
    }

    this.setData({
      activityID:activityID,
      howToPay:howToPay,
      title:title,
    })
    this.requestApplyForm(activityID)
    // 页面初始化 options为页面跳转所带来的参数
  },
  onReady: function () {
    // 页面渲染完成
  },
  onShow: function () {
    // 页面显示
  },
  onHide: function () {
    // 页面隐藏
  },
  onUnload: function () {
    // 页面关闭
  },
  requestApplyForm:function(activityID){
        var that = this 
        getApp().api('manageApi').applyFormPreview({
            data:{
                activity_id:activityID,
                start:0,
                count:90000
            }},
            function success(res){
                console.log(res);
                var data = res.data
                var groupUnits = data.groupUnits
                that.handleData(groupUnits)
            },
            function fail(res){
              console.log(res);
            },
        )
    },

    handleData:function(groupUnits){
      
      for(var i=0;i < groupUnits.length;i++){
        var group = groupUnits[i]
        for(var j=0; j < group.applyUnits.length;j++){
           var apply = group.applyUnits[j]

           var sex = '女'
           if(apply.sex == 2){
              sex = '男'
          }
          var payStatus = '不作考虑'
          if(apply.payStatus == 1){
            payStatus = '待付款'
          }else if(apply.payStatus == 2){
            payStatus = '已付款'

          }else if(apply.payStatus == 3){
            payStatus = '等待退款'
            
          }else if(apply.payStatus == 4){
            payStatus = '已退款'
            
          }else if(apply.payStatus == 5){
            payStatus = '待付款-延后'
            
          }else if(apply.payStatus == 6){
            payStatus = '付款超时'
            
          }else if(apply.payStatus == 7){
            payStatus = '其他付款方式未付'
            
          }else if(apply.payStatus == 3){
            payStatus = '其他付款方式 已付款'
            
          }
          var time = getApp().util.formatTime5(apply.applyTime)

           if(this.data.howToPay > 1){
              //付费
              var item = [
                apply.userName,  //昵称
                apply.actUserName, //帮报名者
                apply.userNo, //会员号
                apply.actUserName, //会员昵称
                apply.mobile,  //电话
                apply.cost/100+'元', //付款金额
                sex, //x性别
                time, //报名时间
                apply.payType,  //支付方式
                payStatus,  //支付状态
              ]
              apply.contents = item

           }else{
              //免费
              var item = [
                apply.userName,  //昵称
                apply.actUserName, //帮报名者
                apply.userNo, //会员号
                apply.actUserName, //会员昵称
                apply.mobile,  //电话
                sex, //x性别
                time, //报名时间
              ]
              apply.contents = item
           }
        }
      }
      console.log('分组数据')
      console.log(groupUnits)
      this.setData({
        groupUnits:groupUnits,
      })
      return



      var applys = data.activityApplies
      var contents = new Array()
      for(var i=0; i<applys.length;i++){
        var apply = applys[i]
        var sex = '女'
        if(apply.sex == 2){
          sex = '男'
        }
        var item = [
          apply.userName,
          apply.actUserName,
          apply.userNo,
          '会员昵称',
          apply.mobile,
          sex,
          apply.applyTime,
        ]
        contents.push(item)
      }
      
      this.setData({
        contents:contents,
      })
    },
  
})