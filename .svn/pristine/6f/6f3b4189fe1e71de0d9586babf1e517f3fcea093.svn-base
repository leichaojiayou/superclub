const session = require("../utils/session");
const utils = require("../utils/util");
const config = require('../utils/constant');

const wxRequest = (param, path) => {
    //show loading dialog
    wx.showToast({
        title: "加载中...",
        icon: "loading"
    })
    let url = config.BASE_URL + path + '?platform=3&sys_version=2.1&api_version=15&_key=' + session.getUserKey()
    let failAction = function (res) {
        param.fail && param.fail(res);
        if (param.failToast) {//如果定制了toast内容，就弹出吐丝（定时吐丝）
            wx.showToast(param.failToast)
        } else {//否则隐藏吐丝
            wx.hideToast();
        }
    }
    wx.request({
        url: url,
        method: param.method || 'GET', // OPTIONS, GET, HEAD, POST, PUT, DELETE, TRACE, CONNECT
        header: {  // 设置请求的 header
            'Content-Type': 'application/json'
        },
        data: param.data || {},
        success: (res) => {
            if (res.statusCode >= 200 && res.statusCode < 300) {
                if (res.data.status == 1) {//请求成功
                    param.success && param.success(res)
                    if (param.successToast) {//如果定制了toast内容，就弹出吐丝（定时吐丝）
                        wx.showToast(param.successToast)
                    } else {//否则隐藏兔兔
                        wx.hideToast();
                    }
                } else {
                    failAction(res)
                }
            } else {
                failAction(res)
            }
        },
        fail: (res) => {
            failAction(res)
        },
        complete: (res) => {
            console.info(url);
            console.info(param.data)
            param.complete && param.complete(res)
        }
    })
}

module.exports = {
    wxRequest
} 