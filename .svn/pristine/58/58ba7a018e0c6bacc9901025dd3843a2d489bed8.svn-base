import session from "../session.js";

const base_url = "https://api.51julebu.com";
const utils = require("../utils/util.js");

const wxRequest = (param, path) => {
    //show loading dialog
    wx.showToast({
        title: "加载中...",
        icon: "loading"
    })
    let url = base_url + path + '?platform=3&sys_version=2.1&api_version=15&_key=' + session.getUserKey()
    wx.request({
        url: url,
        method: param.method || 'GET', // OPTIONS, GET, HEAD, POST, PUT, DELETE, TRACE, CONNECT
        header: {  // 设置请求的 header
            'Content-Type': 'application/json'
        },
        data: param.data || {},
        success: (res) => {
            if (res.statusCode >= 200 && res.statusCode < 300) {
                if (res.data.status != 0) {
                    param.success && param.success(res)
                } else {
                    param.fail && param.fail(res)
                }
            } else {
                param.fail && param.fail(res)
            }
        },
        fail: (res) => {
            param.fail && param.fail(res)
        },
        complete: (res) => {
            wx.hideToast();
            console.log(url);
            param.complete && param.complete(res)
        }
    })
}

module.exports = {
    wxRequest
} 